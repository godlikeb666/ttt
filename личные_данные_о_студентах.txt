USE mydb;

CREATE TABLE faculties (
    faculty_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    seats_count INT
);

CREATE TABLE students (
    student_id INT AUTO_INCREMENT PRIMARY KEY,
    fio VARCHAR(100) NOT NULL,
    birth_date DATE,
    marital_status VARCHAR(50),
    family_info TEXT
);

CREATE TABLE student_groups (
    group_id INT AUTO_INCREMENT PRIMARY KEY,
    group_code VARCHAR(20),
    faculty_id INT,
    FOREIGN KEY (faculty_id) REFERENCES faculties(faculty_id)
);

CREATE TABLE enrollments (
    enroll_id INT AUTO_INCREMENT PRIMARY KEY,
    student_id INT,
    group_id INT,
    course INT,
    specialty VARCHAR(100),
    scholarship DECIMAL(10,2),
    enrollment_year INT,
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (group_id) REFERENCES student_groups(group_id)
);

INSERT INTO faculties (name, seats_count) VALUES 
('ФМФ', 200),
('Ивт', 150),
('Биофак', 100);

INSERT INTO student_groups (group_code, faculty_id) VALUES 
('ФМ-11', 1),
('ФМ-21', 1),
('ИВ-11', 2);

INSERT INTO students (fio, birth_date, marital_status) VALUES 
('Иванов И.И.', '2006-05-15', 'Холост'),
('Петров П.П.', '2005-02-20', 'Холост'),
('Сидоров С.С.', '2008-01-01', 'Холост'),
('Кузнецов К.К.', '2004-10-10', 'Женат');

INSERT INTO enrollments (student_id, group_id, course, specialty, scholarship, enrollment_year) VALUES 
(1, 1, 1, 'Математика', 2000.00, 2023), 
(2, 2, 2, 'Физика', 2500.00, 2022),     
(3, 1, 1, 'Математика', 1500.00, 2025), 
(4, 2, 2, 'Физика', 3000.00, 2022),     
(1, 3, 1, 'Информатика', 0.00, 2023);  
Выборки: 
•	Выбрать количество студентов на каждом курсе 
SELECT course, COUNT(*) AS student_count
FROM enrollments
GROUP BY course;
•	Выбрать суммарную стипендию конкретной группы факультета «ФМФ».
SELECT SUM(e.scholarship)
FROM enrollments e, student_groups g, faculties f
WHERE e.group_id = g.group_id AND g.faculty_id = f.faculty_id
  AND f.name = 'ФМФ'
  AND g.group_code = 'ФМ-21';
•	Выбрать список групп факультета «ФМФ» с указанием численности студентов в каждой группе. 
SELECT g.group_code, COUNT(e.student_id)
FROM student_groups g
JOIN faculties f ON g.faculty_id = f.faculty_id
LEFT JOIN enrollments e ON g.group_id = e.group_id
WHERE f.name = 'ФМФ'
GROUP BY g.group_id;
•	Выбрать список студентов, не достигших к моменту зачисления 18 лет. 
SELECT s.fio, s.birth_date, e.enrollment_year
FROM students s, enrollments e
WHERE s.student_id = e.student_id
  AND (e.enrollment_year - YEAR(s.birth_date)) < 18;
