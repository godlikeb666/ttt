USE mydb;

CREATE TABLE student_groups (
    group_id INT AUTO_INCREMENT PRIMARY KEY,
    group_code VARCHAR(20) NOT NULL,
    course INT,
    student_count INT
);

CREATE TABLE subjects (
    subject_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    category VARCHAR(50),
    hours INT
);

CREATE TABLE teachers (
    teacher_id INT AUTO_INCREMENT PRIMARY KEY,
    fio VARCHAR(100) NOT NULL
);

CREATE TABLE exams (
    exam_id INT AUTO_INCREMENT PRIMARY KEY,
    group_id INT,
    subject_id INT,
    teacher_id INT,
    exam_date DATE,
    control_type ENUM('Зачет', 'Экзамен'),
    FOREIGN KEY (group_id) REFERENCES student_groups(group_id),
    FOREIGN KEY (subject_id) REFERENCES subjects(subject_id),
    FOREIGN KEY (teacher_id) REFERENCES teachers(teacher_id)
);

INSERT INTO student_groups (group_code, course, student_count) VALUES 
('ИС-21', 2, 25),
('ИС-22', 2, 20),
('ПМ-11', 1, 30);

INSERT INTO subjects (name, category, hours) VALUES 
('Высшая математика', 'Математическая', 100),
('Философия', 'Гуманитарная', 50),
('Программирование', 'Компьютерная', 120),
('История', 'Гуманитарная', 40);

INSERT INTO teachers (fio) VALUES 
('Иванов И.И.'),
('Петров П.П.');

INSERT INTO exams (group_id, subject_id, teacher_id, exam_date, control_type) VALUES 
(1, 1, 1, '2025-01-10', 'Экзамен'),
(1, 2, 2, '2025-01-20', 'Зачет'),
(1, 3, 1, '2025-01-10', 'Экзамен'), 
(2, 1, 1, '2025-01-12', 'Экзамен'),
(3, 4, 2, '2025-01-15', 'Экзамен');

Выборки: 
•	Для каждой группы определить продолжительность сессии. 
SELECT g.group_code, DATEDIFF(MAX(e.exam_date), MIN(e.exam_date)) + 1 AS session_days
FROM student_groups g, exams e
WHERE g.group_id = e.group_id
GROUP BY g.group_id;
•	Определить преподавателя, который в сессию принимает экзамены (не зачеты) у наибольшего числа студентов. 
SELECT t.fio
FROM teachers t, exams e, student_groups g
WHERE t.teacher_id = e.teacher_id AND e.group_id = g.group_id
  AND e.control_type = 'Экзамен'
GROUP BY t.teacher_id
ORDER BY SUM(g.student_count) DESC
LIMIT 1;
•	Определить, какой процент от общего объема дисциплин, изучаемых конкретной группой, составляют дисциплины каждой категории. 
SELECT g.group_code, s.category, 
       SUM(s.hours) * 100.0 / SUM(SUM(s.hours)) OVER(PARTITION BY g.group_id)
FROM student_groups g, exams e, subjects s
WHERE g.group_id = e.group_id AND e.subject_id = s.subject_id
GROUP BY g.group_id, s.category;
•	Определить, не сдает ли какая-либо группа два экзамена в один день. 
SELECT g.group_code, e.exam_date
FROM student_groups g, exams e
WHERE g.group_id = e.group_id AND e.control_type = 'Экзамен'
GROUP BY g.group_id, e.exam_date
HAVING COUNT(*) > 1;
